{
  "openapi": "3.0.0",
  "info": { "title": "Gendei Team Management API", "version": "1.0.0" },
  "paths": {
    "/team": {
      "get": {
        "summary": "List Team Members",
        "parameters": [
          { "name": "status", "in": "query", "schema": { "type": "string", "enum": ["pending", "active", "suspended", "all"] } },
          { "name": "role", "in": "query", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "Team members list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "members": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/TeamMember" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/team/invite": {
      "post": {
        "summary": "Invite Team Member",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["email", "role"],
                "properties": {
                  "email": { "type": "string", "format": "email" },
                  "role": { "$ref": "#/components/schemas/TeamRole" },
                  "additionalPermissions": { "type": "array", "items": { "type": "string" } },
                  "message": { "type": "string", "maxLength": 500 },
                  "professionalId": { "type": "string" }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Invitation sent",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Invitation" }
              }
            }
          },
          "400": {
            "description": "Invalid request or email already invited"
          }
        }
      }
    },
    "/team/accept": {
      "post": {
        "summary": "Accept Invitation",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["token"],
                "properties": {
                  "token": { "type": "string" },
                  "name": { "type": "string", "minLength": 2 }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Invitation accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "member": { "$ref": "#/components/schemas/TeamMember" },
                    "clinicId": { "type": "string" },
                    "clinicName": { "type": "string" }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid or expired token"
          }
        }
      }
    },
    "/team/invitations": {
      "get": {
        "summary": "List Pending Invitations",
        "responses": {
          "200": {
            "description": "Invitations list",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "invitations": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Invitation" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/team/invitations/{invitationId}": {
      "delete": {
        "summary": "Revoke Invitation",
        "parameters": [
          { "name": "invitationId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Invitation revoked" } }
      }
    },
    "/team/{memberId}": {
      "get": {
        "summary": "Get Team Member",
        "parameters": [
          { "name": "memberId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "Team member details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/TeamMemberDetail" }
              }
            }
          }
        }
      },
      "patch": {
        "summary": "Update Team Member",
        "parameters": [
          { "name": "memberId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "role": { "$ref": "#/components/schemas/TeamRole" },
                  "permissions": { "type": "array", "items": { "type": "string" } },
                  "deniedPermissions": { "type": "array", "items": { "type": "string" } },
                  "professionalId": { "type": "string", "nullable": true }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "Team member updated" } }
      },
      "delete": {
        "summary": "Remove Team Member",
        "parameters": [
          { "name": "memberId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Team member removed" } }
      }
    },
    "/team/{memberId}/suspend": {
      "post": {
        "summary": "Suspend Team Member",
        "parameters": [
          { "name": "memberId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["reason"],
                "properties": {
                  "reason": { "type": "string", "minLength": 5 }
                }
              }
            }
          }
        },
        "responses": { "200": { "description": "Team member suspended" } }
      }
    },
    "/team/{memberId}/unsuspend": {
      "post": {
        "summary": "Unsuspend Team Member",
        "parameters": [
          { "name": "memberId", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "responses": { "200": { "description": "Team member unsuspended" } }
      }
    },
    "/team/{memberId}/activity": {
      "get": {
        "summary": "Get Member Activity",
        "parameters": [
          { "name": "memberId", "in": "path", "required": true, "schema": { "type": "string" } },
          { "name": "from", "in": "query", "schema": { "type": "string", "format": "date-time" } },
          { "name": "to", "in": "query", "schema": { "type": "string", "format": "date-time" } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 50 } }
        ],
        "responses": {
          "200": {
            "description": "Activity logs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "activities": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/ActivityLog" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/activity": {
      "get": {
        "summary": "Get Clinic Activity",
        "parameters": [
          { "name": "userId", "in": "query", "schema": { "type": "string" } },
          { "name": "resource", "in": "query", "schema": { "type": "string" } },
          { "name": "action", "in": "query", "schema": { "type": "string" } },
          { "name": "from", "in": "query", "schema": { "type": "string", "format": "date-time" } },
          { "name": "to", "in": "query", "schema": { "type": "string", "format": "date-time" } },
          { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 100 } }
        ],
        "responses": {
          "200": {
            "description": "Activity logs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "activities": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/ActivityLog" }
                    },
                    "nextCursor": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "TeamRole": {
        "type": "string",
        "enum": ["owner", "admin", "staff", "reception"]
      },
      "TeamMember": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "clinicId": { "type": "string" },
          "userId": { "type": "string" },
          "email": { "type": "string" },
          "name": { "type": "string" },
          "photoUrl": { "type": "string" },
          "role": { "$ref": "#/components/schemas/TeamRole" },
          "permissions": { "type": "array", "items": { "type": "string" } },
          "status": { "type": "string", "enum": ["pending", "active", "suspended", "removed"] },
          "professionalId": { "type": "string" },
          "lastActiveAt": { "type": "string", "format": "date-time" },
          "createdAt": { "type": "string", "format": "date-time" }
        }
      },
      "TeamMemberDetail": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "email": { "type": "string" },
          "name": { "type": "string" },
          "role": { "$ref": "#/components/schemas/TeamRole" },
          "permissions": { "type": "array", "items": { "type": "string" } },
          "deniedPermissions": { "type": "array", "items": { "type": "string" } },
          "status": { "type": "string" },
          "professionalId": { "type": "string" },
          "invitedBy": { "type": "string" },
          "invitedAt": { "type": "string", "format": "date-time" },
          "acceptedAt": { "type": "string", "format": "date-time" },
          "lastActiveAt": { "type": "string", "format": "date-time" },
          "loginCount": { "type": "integer" },
          "recentActivity": { "type": "array", "items": { "$ref": "#/components/schemas/ActivityLog" } }
        }
      },
      "Invitation": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "clinicId": { "type": "string" },
          "clinicName": { "type": "string" },
          "email": { "type": "string" },
          "role": { "$ref": "#/components/schemas/TeamRole" },
          "status": { "type": "string", "enum": ["pending", "accepted", "expired", "revoked"] },
          "expiresAt": { "type": "string", "format": "date-time" },
          "invitedBy": { "type": "string" },
          "invitedByName": { "type": "string" },
          "createdAt": { "type": "string", "format": "date-time" }
        }
      },
      "ActivityLog": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "userId": { "type": "string" },
          "userName": { "type": "string" },
          "action": { "type": "string" },
          "resource": { "type": "string" },
          "resourceId": { "type": "string" },
          "resourceName": { "type": "string" },
          "details": { "type": "object" },
          "timestamp": { "type": "string", "format": "date-time" }
        }
      }
    }
  }
}
